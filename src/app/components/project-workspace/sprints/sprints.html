<div class="sprints-container">
    <div *ngIf="!showSprintForm">
        <div class="header">
            <h2>Sprints</h2>
            <button class="btn btn-primary" *ngIf="isFounder" (click)="createSprint()">+ New Sprint</button>
        </div>

        <div class="sprints-list" *ngIf="!loading">
            <!-- Backlog Card -->
            <div class="sprint-card backlog-card" (click)="goToBacklog()">
                <div class="sprint-header">
                    <h3>Product Backlog</h3>
                    <span class="status planned">Backlog</span>
                </div>
                <p class="goal">Tasks not yet assigned to a sprint.</p>
                <div class="view-tasks-hint">Click to view tasks â†’</div>
            </div>

            <!-- Sprint Cards -->
            <div class="sprint-card" *ngFor="let sprint of sprints" (click)="viewSprintTasks(sprint.id)">
                <div class="sprint-header">
                    <h3>{{ sprint.name }}</h3>
                    <span class="status" [class]="sprint.status?.toLowerCase()">{{ sprint.status || 'PLANNED' }}</span>
                </div>
                <p class="goal">{{ sprint.goal }}</p>

                <div class="progress-section">
                    <div class="progress-info">
                        <span>Progress</span>
                        <span>{{ sprint.progress | number:'1.0-2' }}%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" [style.width]="sprint.progress + '%'"></div>
                    </div>
                </div>

                <div class="tasks-section" *ngIf="sprint.tasks && sprint.tasks.length > 0">
                    <h4>Tasks ({{ sprint.tasks.length }})</h4>
                    <ul class="task-mini-list">
                        <li *ngFor="let task of sprint.tasks">
                            <span class="task-title">{{ task.title }}</span>
                            <span class="task-status-badge" [class]="task.status?.toLowerCase()">{{ task.status
                                }}</span>
                        </li>
                    </ul>
                </div>

                <div class="sprint-actions" *ngIf="isFounder">
                    <button class="btn btn-secondary" (click)="editSprint(sprint); $event.stopPropagation()">Edit</button>
                    <button class="btn btn-danger"
                        (click)="deleteSprint(sprint); $event.stopPropagation()">Delete</button>
                </div>
            </div>
        </div>

        <div class="empty-state" *ngIf="!loading && sprints.length === 0">
            <p>No sprints found.</p>
            <button class="btn btn-primary" *ngIf="isFounder" (click)="createSprint()">Create First Sprint</button>
        </div>
    </div>

    <div *ngIf="showSprintForm">
        <app-sprint-form [sprint]="sprintToEdit" (sprintSubmitted)="handleSprintSubmitted($event)"
            (cancel)="handleCancel()"></app-sprint-form>
    </div>
</div>